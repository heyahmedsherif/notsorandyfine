---
import Layout from '../layouts/Layout.astro';
import LeaderboardEntry from '../components/LeaderboardEntry.astro';
import figures from '../data/public-figures.json';

const champions = figures.filter(f => f.tier === 'champion').sort((a, b) => b.score - a.score);
const silent = figures.filter(f => f.tier === 'silent').sort((a, b) => b.score - a.score);
const enablers = figures.filter(f => f.tier === 'enabler').sort((a, b) => a.score - b.score);
---

<Layout title="Accountability Tracker — #NotSoRandyFine">
  <section class="py-12 bg-white">
    <div class="max-w-4xl mx-auto px-4">
      <h1 class="section-heading">Accountability Tracker</h1>
      <p class="text-gray-600 mb-8 max-w-2xl">
        Tracking how public figures have responded to Randy Fine's hateful rhetoric.
        Who's speaking up? Who's staying silent? Who's enabling?
      </p>

      <!-- Tier filters -->
      <div class="flex flex-wrap gap-2 mb-8">
        <button class="tier-btn active px-4 py-2 rounded-full text-sm font-medium bg-navy-800 text-white" data-tier="all">
          All ({figures.length})
        </button>
        <button class="tier-btn px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-700 hover:bg-green-200" data-tier="champion">
          Champions ({champions.length})
        </button>
        <button class="tier-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-600 hover:bg-gray-200" data-tier="silent">
          Silent ({silent.length})
        </button>
        <button class="tier-btn px-4 py-2 rounded-full text-sm font-medium bg-red-100 text-red-700 hover:bg-red-200" data-tier="enabler">
          Enablers ({enablers.length})
        </button>
      </div>

      <!-- Champions -->
      <div class="mb-8 tier-section" data-tier="champion">
        <h2 class="text-xl font-bold text-green-700 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-green-500"></span>
          Champions — Speaking Out Against Hate
        </h2>
        <div class="space-y-3">
          {champions.map(figure => <LeaderboardEntry {...figure} />)}
        </div>
      </div>

      <!-- Silent -->
      <div class="mb-8 tier-section" data-tier="silent">
        <h2 class="text-xl font-bold text-gray-600 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-gray-400"></span>
          Silent — Refusing to Take a Stand
        </h2>
        <div class="space-y-3">
          {silent.map(figure => <LeaderboardEntry {...figure} />)}
        </div>
      </div>

      <!-- Enablers -->
      <div class="mb-8 tier-section" data-tier="enabler">
        <h2 class="text-xl font-bold text-red-700 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-red-500"></span>
          Enablers — Defending Hate
        </h2>
        <div class="space-y-3">
          {enablers.map(figure => <LeaderboardEntry {...figure} />)}
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  const tierBtns = document.querySelectorAll('.tier-btn');
  const sections = document.querySelectorAll('.tier-section');

  tierBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const tier = btn.getAttribute('data-tier');

      tierBtns.forEach(b => {
        b.classList.remove('bg-navy-800', 'text-white', 'active');
        if (b.getAttribute('data-tier') === 'champion') {
          b.classList.add('bg-green-100', 'text-green-700');
        } else if (b.getAttribute('data-tier') === 'silent') {
          b.classList.add('bg-gray-100', 'text-gray-600');
        } else if (b.getAttribute('data-tier') === 'enabler') {
          b.classList.add('bg-red-100', 'text-red-700');
        }
      });

      btn.classList.add('bg-navy-800', 'text-white', 'active');
      btn.classList.remove('bg-green-100', 'text-green-700', 'bg-gray-100', 'text-gray-600', 'bg-red-100', 'text-red-700');

      sections.forEach(section => {
        const sectionTier = section.getAttribute('data-tier');
        (section as HTMLElement).style.display = (tier === 'all' || sectionTier === tier) ? '' : 'none';
      });
    });
  });
</script>
